---
layout: post
permalink: /2007/04/post_80.html
title: "[April Fool]「フォト蔵」から学ぶ効率のよいマルチスレッド処理と自社サーバのススメ"
date: 2007-04-01T12:00:10.00+09:00
tags:
  - "naoya"
categories:
  - "お知らせ"
---
ムノウラボをご覧の良い子の皆様、こんにちは。<br />
<br />
以前フォト蔵サーバをホスティング業者から自社サーバに移民させたことは記載せていただいたと思いますが、今回は<strong>フォト蔵サーバ内でどういう処理を、どう効率よく進めているか？</strong>を写真を交えながらご紹介したいと思います。<br />
<br />
非常に高効率なマルチスレッド処理なので、サーバ構築の際は是非参考にしてみてください。<br />
<br />
まず、処理のノウハウに先だちまして、フォト蔵のサーバをホスティング業者から自社サーバに移民させた理由を説明します。<br />
<br />
【移民させた理由】<OL><LI>マシンの増員に時間がかかり、フレキシブルに対応できない</LI><LI>フォト蔵のような写真系のサービスの場合、十分広い暗室を確保する必があるが、暗室を確保するにはコストがかかる。</LI><LI>フォト蔵のような写真系サービスの場合、大容量の現像液・現像停止液必要になるが、大容量の現像停止液を搭載したマシンは酢酸臭くなり、ホスティグ業者に迷惑がかかる。</LI></OL><br />
<br />
とにかく、自社サーバにしてから処理速度の向上と、高効率なマルチスレッド処理を、低コストで実現する事ができました。そのノウハウを写真を交えながらご案内します。<br />
<br />
<H3>まずはサーバルームの写真から紹介しましょう。</H3><a href="http://photozou.jp/photo/photo_only/784/2809363?size=800"><img src="http://photozou.jp/pub/784/784/photo/2809363.jpg" alt="サーバルーム" width="337" height="450" style="border: solid 1px #000;"></a><br><a href="http://photozou.jp/photo/photo_only/784/2809363?size=800">サーバルーム</a> posted by <a href="http://photozou.jp/mypage/top/784">(C)モロ蔵</a><br />
<br />
サーバは熱を発するため、サーバルームは常に熱気ムンムン。クーラーでは追いつかないため、扇風機も常時動かしています。サーバ内部はさらに暑いです。時折、サーバから出てしっかりとすずまないと理性がなくなります。<strong>温度は常に監視し、緊急時には外へ出す事が処理速度をはやめる秘訣です。</strong><br />
<br />
<H3>次はサーバ内部の様子です</H3><a href="http://photozou.jp/photo/photo_only/784/2808961?size=800"><img src="http://photozou.jp/pub/784/784/photo/2808961.jpg" alt="サーバ内部" width="450" height="337" style="border: solid 1px #000;"></a><br><a href="http://photozou.jp/photo/photo_only/784/2808961?size=800">サーバ内部</a> posted by <a href="http://photozou.jp/mypage/top/784">(C)モロ蔵</a><br />
<br />
主に写真の現像、アルバムへ保存する作業をしています。暑さと酢酸の刺激臭と戦いです。流れ作業ではなく、各自が自主的に仕事を探し、処理を行っています。人数分だけマルチスレッド処理が可能になり、非常に効率があがりました。また、<strong>写真にこだわりをもったサーバなので、写真のチェックは常に２人がかり</strong>です。<br />
<br />
<H3>最後は動画のエンコード処理、熱暴走手前の状態です。</H3><a href="http://photozou.jp/photo/photo_only/784/2810110?size=800"><img src="http://photozou.jp/pub/784/784/photo/2810110.jpg" alt="動画のエンコード処理" width="450" height="337" style="border: solid 1px #000;"></a><br><a href="http://photozou.jp/photo/photo_only/784/2810110?size=800">動画のエンコード処理</a> posted by <a href="http://photozou.jp/mypage/top/784">(C)モロ蔵</a><br />
<br />
動画のエンコード中です。動画のエンコードは非常に高負荷な処理のため、CPUの熱が急上昇します。理性がなくなったサーバがいますが、この後外に出してすずませます。常に監視をしておく必要があり、手間がかかりますが、彼らのおかげで処理速度は以前に比べてはるかに向上しました。<br />
<br />
今回はサーバ構築にあたってかなりコアな部分を書きました。精神面でもいろいろ工夫をしていますので、それについてはまた後日書きたいと思います。<br />
<br />
なお、非常に残念ではありますが<a href="http://www.unoh.net/news/2007/04/post_40.html">本日ウノウ株式会社がムノウ株式会社に買収された</a>ため、今後はムノウラボとして活動していきます。<br />
<br />
<h1>4月2日追記</h1><br />
<span style="color: #FF0000;">エイプリルフールネタです。</span><br />
<br />

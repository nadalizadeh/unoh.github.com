---
layout: post
permalink: /2009/07/i_20.html
title: "iモードブラウザ 2.0まとめ"
date: 2009-07-13T22:11:54.00+09:00
tags:
  - "isogawa"
categories:
  - "携帯"
---
<p>こんばんは、五十川です。</p>
<p>ご存知の通り、5月以降に発売開始されたNTTドコモの携帯電話の殆どには、新しいiモードブラウザ 2.0が搭載されています。iモードブラウザの大幅な仕様の拡張はi-XHTMLの登場以来ということになりますが、iモードの登場から10年経って登場した新しいブラウザは、i-XHTMLのときよりも遥かに大きな、過去最大の変化を遂げています。</p>
<p>iモードブラウザ 2.0の詳細は、ドコモ公式の<a href="http://www.nttdocomo.co.jp/service/imode/make/content/browser/browser2/">iモードブラウザ 2.0</a>にまとめられています。以下では主要な変更点を確認していこうと思います。</p>

<hr />

<h3>キャッシュ容量拡大</h3>
<p>1画面あたり読み込めるデータの最大量が、従来の100Kバイトから500Kバイトに、大幅に拡大されました。ご存知の通りiモードの場合この値は、画像などの外部リソースもすべてひっくるめた値ですが、iモードブラウザ 2.0では、新たにCSSファイルやJavaScriptファイルも外部から読み込めるようになりましたので、これらのデータ量もこの制限の対象になります。</p>
<p>なお従来は、最大データ量を超過した場合には、単に警告が表示されるだけというのが一般的だったと思いますが、iモードブラウザ 2.0搭載機種では、機種によるのかもしれませんが、「フルブラウザに切り替えると見れます。切り替えますか？」といった旨のダイアログが表示されるようになっているようです。</p>
<p>なお、サーバサイドでブラウザのバージョンを判定する必要がある場合は、User-Agent文字列中のキャッシュサイズを示す箇所の値が&ldquo;500&rdquo;（以上）であるかどうかで行います。</p>

<hr />

<h3>Cookie対応</h3>
<p>これまではCookieが利用できなかったため、ドコモ端末に対応したウェブアプリケーションでは、セッションIDをURLに付与する実装が広く行われてきました。他のキャリアはCookieが使えるため、ドコモのみ他と異なる実装が必要で、かつセッションフィクセーションなどの攻撃に対して細心の注意を払う必要がありましたが、ついにCookieがサポートされたことで、iモードブラウザ 2.0を搭載した端末に限っては、他のキャリアと同様の実装が行えるようになったということになります。</p>
<p>iモードブラウザ 2.0のCookieの仕様は以下のようになっています。</p>
<ul>
  <li>端末で有効無効の設定可能（デフォルトは有効）</li>
  <li>1件あたり4Kbytesまで、1ドメインあたり20件まで保存</li>
  <li>SIM単位</li>
</ul>
<p>余談ですが、これまでドコモユーザは、Cookie利用を前提とした海外のケータイサイトを利用できず、一方日本のケータイサイトは、攻撃に対する安易な防衛策として、IPネットワークによるアクセス制限が広く実施されてきました。個人的には最大手キャリアのこの仕様が、日本のケータイサイトの、いわゆるガラパゴス化の一因であったのではないかと思っているので、今回のCookie対応は望ましことではないかと考えています。いや、時既に遅しな気もしますけどね。</p>

<hr />

<h3>Referer対応</h3>
<p>これはiモードブラウザ 2.0で最も注意しなければならない変更です。</p>
<p>Cookieの項でも述べた通り、ドコモ対応のウェブアプリケーションではセッションIDをURLに付与する実装が広く行われてきました（iモードIDを利用することでこれを回避できますが、iモードIDが登場したのは比較的最近で、それ以前は、公式サイト以外では、URLにセッションIDを付与するか、すべての遷移でUTN属性を使用した個体識別番号の取得を行い続ける以外に、持続的なセッションを管理する方法はありませんでした）。セッションIDが第三者に漏れるとセッションフィクセーションなどの攻撃に晒される危険が生じるわけですが、これまでのiモード端末はRefererを送出しないため、少なくともこれによるセッションIDの漏洩の危険はなかったわけです。しかし、Refererを送出するiモードブラウザ 2.0に対してもセッションIDを含むURLにアクセスさせている場合は、RefererによるセッションIDの漏洩の危険が生じますので、Cookieを利用する（あるいはiモードIDを利用する）ように変更する必要があるかもしれません。</p>
<p>Refererの送出も、Cookieと同様に端末で有効無効の設定が可能です（デフォルトは有効）。</p>

<hr />

<h3>VGA対応</h3>

<p>ブラウザ画面のVGAサイズでの表示が可能になりました（以下、ドコモの記述に合わせてVGA/QVGAという表現を使いますが、従来もQVGAが必ずしも240×320ピクセルではなかったのと同様に、VGAと言っても必ずしも480×640ピクセルというわけではありません）。</p>
<p>表示モードは、サイト側が以下のようなMETA要素を記述することで決定します。</p>
<pre class="code">&lt;meta
 name=&quot;disparea&quot;
 content=&quot;{qvga|vga}&quot;/&gt;</pre>
<p>content属性値が&ldquo;vga&rdquo;であれば、VGAモードになります。値が&ldquo;qvga&rdquo;であるか、このMETA要素がないHTMLはQVGAサイズで描画されます。</p>
<p>三大キャリの中でいち早くVGAに対応したソフトバンクでは、VGAかQVGAかはユーザが端末で設定して切り替えますが、ドコモの場合はユーザが変更することはできません。これは、従来との互換性を最大限保つために決定された仕様なのでしょう。</p>
<p>しかし、この画面サイズの変更によって問題が生じる場合もあります。</p>

<h4>画面サイズの管理</h4>
<p>ひとつは画面サイズの管理です。ご承知の通り、auやソフトバンクと異なり、iモードブラウザはHTTPヘッダに画面サイズ情報を含まないため、画面サイズを特定する必要があるケータイサイトでは、端末ごとの画面サイズを独自に管理する必要があり、これはiモードブラウザ 2.0でも同様です。しかし、これまでブラウザの画面サイズは、原則1端末あたり1種類でしたが、iモードブラウザ 2.0では、VGAとQVGAの2種類の画面サイズが存在するため、サイトが対応する画面サイズに応じて、適切な値を管理しなければなりません。</p>
<p>携帯端末の判別を行うライブラリとしては、Perlでは<a href="http://search.cpan.org/perldoc?HTTP::MobileAgent">HTTP::MobileAgent</a>、PHPでは<a href="http://pear.php.net/package/Net_UserAgent_Mobile">Net_UserAgent_Mobile</a>がよく利用されているかと思われますが、いずれも現時点での最新バージョン（HTTP::MobileAgentは2009年7月7日付けの0.28、Net_UserAgent_Mobileは2009年6月23日付けの1.0.0）に含まれる画面サイズは、iモードブラウザ 2.0搭載端末のものはVGAのもののみとなっているようです。</p>
<p>以下は、Net_UserAgent_Mobile 1.0.0の構成ファイル中、画面サイズデータを管理しているNet/UserAgent/Mobile/DoCoMo/ScreenInfo.phpの、P-07Aの箇所ですが、縦横のサイズはそれぞれ1種類、VGAのもののみとなっています。</p>
<pre class="code">...
// i-mode browser 2.0
'P07A3' =&gt; array(
                'width'  =&gt; 480,
                'height' =&gt; 662,
                'depth'  =&gt; 262144,
                'color'  =&gt; 1
                ),
...</pre>
<p>従って以下のようなコードでは、画面の幅を返す<code>Net_UserAgent_Mobile_Display-&gt;getWidth()</code>は、VGAの値である&ldquo;480&rdquo;を返します。</p>
<pre class="code">// As of Net_UserAgent_Mobile 1.0.0
$mobile  = Net_UserAgent_Mobile::singleton('DoCoMo/2.0 P07A3(c500;TB;W24H15)');
$display = $mobile-&gt;makeDisplay();
$display-&gt;getWidth(); // 480</pre>
<p>もしこれらのライブラリを利用しているウェブアプリケーションがQVGAサイズを想定したものである場合は、これらの値を独自にメンテナンスする必要があるかもしれません。幸いどちらのライブラリも、クラスファイルに直接手を入れる必要はなく、別途にXMLファイルで画面サイズを管理できるようになっているので、サイトがQVGAに対応したものであれば、QVGAの値を入れたXMLファイルを用意すればよいでしょう。</p>
<p>あるいはもし、アプリケーションがVGAとQVGAの両方をページによって切り替えるようなものである場合は、これらのライブラリの現時点での実装では要件を満たせないかもしれません。</p>

<h4>横画面のサイズ</h4>
<p>もうひとつの問題は横画面のサイズです。これまでにも横画面をサポートした端末は存在しましたが、その画面サイズはいずれも240×240ピクセルでした（画面の横方向に余白があり、そこには時計などが表示されていました）。つまり、縦画面でも横画面でも、画面の幅はいずれも240ピクセルだったわけです。しかしiモードブラウザ 2.0搭載端末の横画面サイズは、従来と同じ240×240ピクセルのものもある一方で、そうではないものも登場しています。iモードブラウザ 2.0の仕様は下位互換性の維持に極力留意されていますが、この点はそうではありません。</p>
<p>例えばP-07Aの場合、QVGAの画面サイズは、縦画面では240×331ピクセル、横画面では427×178ピクセルと、単純に幅と高さが入れ替わった値ですらありません。</p>
<p>従って、画面の横幅を必要とするケータイサイトは、横画面にも対応しなければならない場合は改修が必要かもしれないのですが、困ったことに、サーバサイドのプログラムだけで、アクセスしてきたケータイが横画面であるか縦画面であるかを区別し、その画面サイズを特定するのは容易ではありません。</p>
<p>サーバプログラムが画面の縦横を判定する手がかりとなる、つまり端末から送られてくる情報の中で、画面の縦横で変化するのは、唯一User-Agentに含まれる、表示可能な文字数の値です。従って、この値に、それぞれの画面サイズを紐付けて管理しておけばよいわけですが、悪いことに、この値はユーザが端末で設定するフォントサイズによっても変化します。</p>

<table>
  <thead>
    <tr><th>縦/横</th><th>User-Agent</th><th>文字サイズ設定</th></tr>
  </thead>
  <tbody>
    <tr><td rowspan="4">縦画面</td><td>DoCoMo/2.0 P07A3(c500;TB;W16H10)</td><td>特大</td></tr>
    <tr><td>DoCoMo/2.0 P07A3(c500;TB;W20H12)</td><td>拡大</td></tr>
    <tr><td>DoCoMo/2.0 P07A3(c500;TB;W24H15)</td><td>標準</td></tr>
    <tr><td>DoCoMo/2.0 P07A3(c500;TB;W30H18)</td><td>縮小</td></tr>
    <tr><td rowspan="4">横画面</td><td>DoCoMo/2.0 P07A3(c500;TB;W28H05)</td><td>特大</td></tr>
    <tr><td>DoCoMo/2.0 P07A3(c500;TB;W35H06)</td><td>拡大</td></tr>
    <tr><td>DoCoMo/2.0 P07A3(c500;TB;W42H08)</td><td>標準</td></tr>
    <tr><td>DoCoMo/2.0 P07A3(c500;TB;W53H09)</td><td>縮小</td></tr>
  </tbody>
</table>

<p>これらの値をどうにか管理することで縦画面か横画面かの判定が可能かと思われますが、やはり従来に比べれば煩雑な管理を強いられてしまうでしょう。</p>

<hr />

<h3>i-CSS2</h3>
<p>これまでのiモードのCSS（i-CSS）で指定できるのは、基本的にはHTMLの要素/属性で表現可能なものに限られていました。また、その記述は一部の例外を除いて要素のstyle属性で行わなければならず、CSSを有効にするにはContent-Type: application/xhtml+xmlの出力が必須であるなど、他の携帯キャリアとも互換性に乏しいものでした。</p>
<p>これに対してiモードブラウザ 2.0のCSS（i-CSS2）は、以下の改善がなされています。</p>
<ul>
  <li>STYLE要素に普通に記述でき、LINK要素による外部ファイルの読み込みもおk</li>
  <li>Content-Typeに依存しない（text/htmlでもおｋ）</li>
</ul>
<p>対応する記述も大幅に増え、より標準に近い指定が可能になりました。ただし制限事項も多くあり、標準的なCSSがそのまま再現できるというわけではありません。</p>
<ul>
  <li>@importなどは無視される</li>
  <li>
    対応するセレクタは、以下の基本的な書式のみ
    <ul>
      <li>*</li>
      <li>E</li>
      <li>E F</li>
      <li>E#myId</li>
      <li>E.myClass</li>
    </ul>
  </li>
</ul>
<p>またもちろん、フォント関連の各種指定やoverflow:autoなどのように、ブラウザの実装などの制約に制限されるものは利用できません。</p>
<p>以下はiモードシミュレータで<a href="http://ja.wikipedia.org/wiki/Acid2">Acid2</a>テストを実行した画面ですが、残念ながらテストのクリアにはほど遠い状態です（それでももちろん、これまでのi-CSSよりは格段の進歩ではありますが）。</p>
<div>
  <a href="http://photozou.jp/photo/show/784/23459225"><img src="http://art11.photozou.jp/pub/784/784/photo/23459225.png" alt="iモードシミュレータでAcid2テストを実行した図" width="253" height="371" /></a><br />
  <a href="http://photozou.jp/photo/show/784/23459225">iモードシミュレータでAcid2テストを実行した図</a>
</div>
<h4>font-sizeについて</h4>
<p>これまでのiモードのCSS（i-CSS）ではfont-sizeはlarge/medium/small系の指定しかできませんでした。また、表示上有効なサイズは、原則として大中小の3段階で、本来の7段階の指定は反映されませんでした。</p>
<div>
  <a href="http://photozou.jp/photo/show/784/23459231"><img src="http://art13.photozou.jp/pub/784/784/photo/23459231.png" alt="従来のiモードブラウザのlarge/medium/smallの表示" width="256" height="364" /></a><br />
  <a href="http://photozou.jp/photo/show/784/23459231">従来のiモードブラウザのlarge/medium/smallの表示</a>
</div>
<p>iモードブラウザ 2.0のCSS（i-CSS2）でも、large/medium/small系の指定は従来と同じです。これは、おそらく下位互換性を考慮しての決定だと思われます。</p>
<div>
  <a href="http://photozou.jp/photo/show/784/23459245"><img src="http://art11.photozou.jp/pub/784/784/photo/23459245.png" alt="iモードブラウザ 2.0/QVGAのlarge/medium/smallの表示" width="248" height="342" /></a><br />
  <a href="http://photozou.jp/photo/show/784/23459245">iモードブラウザ 2.0/QVGAのlarge/medium/smallの表示</a>
</div>
<p>また、large/medium/small系の指定は、VGAとQVGAで画面上の「見た目」が同じになるようになっています。</p>
<div>
  <a href="http://photozou.jp/photo/show/784/23459278"><img src="http://art12.photozou.jp/pub/784/784/photo/23459278.png" alt="iモードブラウザ 2.0/VGAのlarge/medium/smallの表示" width="248" height="342" /></a><br />
  <a href="http://photozou.jp/photo/show/784/23459278">iモードブラウザ 2.0/VGAのlarge/medium/smallの表示</a>
</div>
<p>一方i-CSS2では、%やem、px、ptなどによる指定も可能になっていますが、pxやptなどでの指定は、VGAとQVGAでは画面上の「見た目」が異なる点に注意する必要があります。</p>
<p>端末でのフォントサイズ設定が標準の場合、QVGAでは、medium/100%/1emは20px/15ptで描画されます。一方VGAのmedium/100%/1emは40px/30ptと、QVGAの倍のサイズで描画されます。</p>
<div>
  <a href="http://photozou.jp/photo/show/784/23459253"><img src="http://art11.photozou.jp/pub/784/784/photo/23459253.png" alt="QVGAのフォントサイズ指定" width="248" height="368" /></a><br />
  <a href="http://photozou.jp/photo/show/784/23459253">QVGAのフォントサイズ指定</a>
</div>
<div>
  <a href="http://photozou.jp/photo/show/784/23459291"><img src="http://art11.photozou.jp/pub/784/784/photo/23459291.png" alt="VGAのフォントサイズ指定" width="248" height="342" /></a><br />
  <a href="http://photozou.jp/photo/show/784/23459291">VGAのフォントサイズ指定</a>
</div>
<p>つまり、large/medium/small系や、%、emなどでの指定では、VGAとQVGAで1行あたりに表示可能な文字数は同じで、つまり見た目も同じになりますが、px/ptなどでの指定では、VGAとQVGAで同じ値を指定した場合、1行あたりに表示可能な文字数は、VGAではQVGAの倍（見た目は半分）となるわけです。</p>

<hr />

<h3>JavaScript</h3>
<p>iモードブラウザ 2.0では、ECMA-262準拠のJavaScriptが利用できることになっています。残念ながら、初期のiモードブラウザ 2.0搭載端末の一時的な発売中止以来、現時点までJavaScript機能は無効にされたままですが、今後のソフトウェアアップデートにより、いずれ利用できるようになるでしょう。</p>
<p>iモードブラウザ 2.0のJavaScriptは、DOMやXMLHttpRequestを含む本格的な実装となっています。CSSが標準準拠を謳いながら、あいにく標準からははまだまだかけ離れたものであるのとは対照的に、JavaScriptについては、CSSと異なり下位互換性に配慮する必要がなかったからでしょうか、CSSなど他の実装の制約に依存するものを除いては、基本的にかなり標準に忠実な実装となっており、PC向けのウェブブラウザ向けに書かれたJavaScriptが、そのままで、あるいはわずかな修正で動作する可能性があります。</p>
<p>以下は試しに、<a href="http://clipp.in/">clipp</a>の<a href="http://clipp.googlegroups.com/web/clipp-json-feeds.zip">JSONP形式フィードをパースして表示するJavaScriptのサンプルプログラム</a>を、iモードシミュレータで動作させてみた図です。</p>
<div>
  <a href="http://photozou.jp/photo/show/784/23459260"><img src="http://art11.photozou.jp/pub/784/784/photo/23459260.png" alt="JSONPフィードを表示するサンプルプログラムを動作させてみた図" width="248" height="342" /></a><br />
  <a href="http://photozou.jp/photo/show/784/23459260">JSONPフィードを表示するサンプルプログラムを動作させてみた図</a>
</div>
<p>これはその作りがそもそも非常に簡単なものであるためというのもありますが、CSSとそれに関連する箇所のわずかな修正だけですんなりと動作させることができました。</p>
<p>さらに、iPhone向けサイトのJavaScriptフレームワークの定番である<a href="http://code.google.com/p/iui/">iUI</a>を修正して、iモードシミュレータで動作させてみました。</p>
<div>
  <a href="http://photozou.jp/photo/show/784/23459272"><img src="http://art12.photozou.jp/pub/784/784/photo/23459272.png" alt="iUI修正して動作させてみた図" width="253" height="371" /></a><br />
  <a href="http://photozou.jp/photo/show/784/23459272">iUI修正して動作させてみた図</a>
</div>
<p>CSSについては結構手を加える必要がありましたが（そしてまだまだiUI本来のものの再現にはほど遠い出来映えですが）、JavaScriptについては一切手を加えることなく、iUIのサンプルをシミュレータで動作させることができました。iUIのJavaScriptは結構複雑ですが、それが概ねきちんと動作するというのは、iモードブラウザ 2.0のJavaScript機能には大きな期待を抱かずにはいられません。</p>

<hr />

<h3>マルチメディア関連</h3>

<h4>PNGとBMPに対応</h4>
<p>PNGが表示できるようになりました。これでようやく三大キャリアの端末がGIF、JPEG、PNGのいずれにも対応するということになります。</p>

<h4>Flash Video対応</h4>
<p>FLVファイルが再生できるようになりました。再生方式はインラインとプログレッシブダウンロードが利用できます。インライン再生の場合は、データ容量は、1画面あたり読み込めるデータの最大量（500Kbytes）で制限されます。一方プログレッシブダウンロードでは、iモーションと同様10Mbytesまでの動画を配信できます。</p>

<h4>Windows Media対応</h4>
<p>初期のFOMAには、ASFコンテナを採用した<a href="http://www.nttdocomo.co.jp/service/imode/make/content/imotion/asf/">ASF対応iモーション</a>（コーデックはMPEG4/AMR）というものがありましたが、決してそれが復活したわけではなく、一般的なWindows Mediaが再生できるようになりました。</p>
<p>対応コーデックはWindows Media Video/Audio 9で、基本的に320×240px/500Kbps/30fpsといった仕様の動画が再生可能です。配信方式はストリーミングが基本ですので、配信にはWindows Mediaサーバが必要になります（機種によってはダウンロード再生も可能ということです）。ストリーミング配信では、サーバにアクセスするのはiモードブラウザではなくWindows Mediaプレイヤーになり、そのUser-Agentは、<code>NSPlayer/9.0 ({機種名}_iB;FOMA)</code>のように、Windows Mediaプレイヤーの標準的なものに準じたものになります。</p>
<p>ページ内への埋め込みは、なぜかEMBED要素を使用することになっています（指定できる属性はSRCとTYPEのみです）。</p>
<pre class="code">&lt;embed
 type=&quot;video/x-ms-asx&quot;
 src=&quot;hoge.asx&quot;/&gt;</pre>

<h3>スクリーンキャプチャ、テキストのコピー＆ペースト、およびこれらの禁止設定</h3>
<p>スクリーンキャプチャは、画面メモの保存時に、従来のものに加えて表示画面を静止画像として保存できる機能です。スクリーンキャプチャは、通常の画像とは異なり、「データ」フォルダではなく、画面メモのひとつとして保存され、再配布やコピーはできません。</p>
<p>テキストのコピーは、従来のフォーム要素だけではなく、ページ内のすべてのテキストがコピーできるようになりました。テキストのコピーは、iモードブラウザ 2.0で標準仕様になった疑似ポインタを利用することで、広い範囲をスムーズに選択できるようになっています。</p>
<p>また、新たに導入されたMETA要素によって、これらと、画像の保存および画面メモを禁止できるようになりました。なおフレームドキュメントの場合は、フレームを構成するドキュメントのいずれかひとつにでもこの指定があれば、フレームの全ドキュメントで禁止になります。</p>
<pre class="code">&lt;meta
 name=&quot;prohibition&quot;
 content=&quot;{image|text|image,text}&quot;/&gt;</pre>
<p>content属性値で禁止対象を指定します。</p>
<ul>
  <li>image: スクリーンキャプチャ, 画面メモ, 画像保存を禁止</li>
  <li>text: テキストコピーを禁止</li>
  <li>image,text: 全部禁止</li>
</ul>

<hr />

<h3>フレーム対応</h3>
<p>iモードブラウザ 2.0はFRAMEおよびIFRAMEに対応しています。ただしPC向けのウェブブラウザと異なり、スクロールバーは表示されません（スクロールはできます）。またフレームの内外への移動は、iモードブラウザ 2.0で標準仕様になった疑似ポインタを利用するのが基本のようです。</p>

<hr />

<h3>マルチウィンドウ対応</h3>
<p>iモードブラウザ 2.0では、最大5ヶのブラウザ画面を保持できるようになっており、&ldquo;target="_blank"&rdquo;などを付与したリンクなどは、新しいブラウザ画面で表示されます。</p>
<p>もっとも、ドコモは「ウィンドウ」という表現をしていますが、ウィンドウシステムというわけではなく、画面を切り替えるというイメージです。</p>

<hr />

<h3>マイニュース、マイリンク</h3>
<h4>マイニュース</h4>
<p>iメニューのトップページに、登録したフィードの更新情報を簡易に表示できる機能です。フィードを登録させるには、以下のようなリンクを用意します。</p>
<pre class="code">&lt;a href=&quot;http://docomo.ne.jp/cp/siteadd.cgi?
   sflg=1&amp;amp;
   surl={フィードURL}&amp;amp;
   nl={戻り先URL}&quot;&gt;マイニュース登録&lt;/a&gt;</pre>

<h4>マイリンク</h4>
<p>iメニューのトップページに、登録したURLのリンクが表示される、簡易なオンラインブックマーク機能です。URLを登録させるには、以下のようなリンクを用意します。</p>
<pre class="code">&lt;a href=&quot;http://docomo.ne.jp/cp/siteadd.cgi?
   sflg=2&amp;amp;
   surl={ブックマークするURL}&amp;amp;
   snm={ブックマーク名}&amp;amp;
   nl={戻り先URL}&quot;&gt;マイリンク登録&lt;/a&gt;</pre>

<p>マイニュース、マイリンクはまだユーザに馴染みの薄い機能ですので、以下のような、説明ページへのリンクを添えるとよいかもしれません。</p>
<pre class="code">&lt;a href=&quot;http://docomo.ne.jp/imt/my/week/03bunsan_mynews_it&quot;&gt;マイニュースとマイリンクとは&lt;/a&gt;</pre>

<hr />

<h3>その他</h3>

<h4>User-Agent</h4>
<p>User-Agentの書式は従来と同じです。これだけ大きな変更にも関わらず、冒頭の&ldquo;DoCoMo&rdquo;に続くバージョン番号も&ldquo;2.0&rdquo;のままで変わりありません。これも下位互換性に配慮したものなのでしょうか。サーバサイドでブラウザのバージョンを判定する必要がある場合は、User-Agent文字列中のキャッシュサイズを示す箇所の値が"500"（以上）であるかどうかで行います。</p>

<h4>左右キーの割り当て変更</h4>
<p>iモードブラウザ 2.0搭載端末では、ユーザインタフェースには大きな変更があります。従来十字キーの左右は、「戻る/進む」機能でしたが、戻る/進む機能は左右のソフトキーに割り当てとなり、十字キーの左右は左右のフォーカス移動に変更になりました。これはつまり、ソフトバンクのキー割当と同じです。従来の端末から機種変更したユーザは、これには戸惑うことでしょう。</p>

<h4>Shift_JISテキスト形式の絵文字ついに廃止</h4>
<p>ドコモでは絵文字の記述方式がいくつかありますが、そのうちのひとつ、Shift_JISテキスト形式（&amp;#nnnn;形式）がついに廃止になりました。この書式は従来でも推奨されていませんでしたので、使用しているサイトは多くはないと思われますが、使用している場合は他の書式にあらためる必要があります。</p>

<h4>DOCTYPE宣言</h4>
<p>iモードブラウザ 2.0でのi-XHTMLのDOCTYPE宣言は以下のものということになっています。これは従来のものと、&ldquo;Ver.=ja/2.3&rdquo;の箇所のバージョン番号が変わった以外は同じで、DTDのURIすら変わっていません。また、従来通りDOCTYPE宣言はレンダリングには影響しないようです。</p>
<pre class="code">&lt;!DOCTYPE html PUBLIC
 &quot;-//i-mode group (ja)//DTD XHTML i-XHTML(Locale/Ver.=ja/2.3) 1.0//EN&quot;
 &quot;i-xhtml_4ja_10.dtd&quot;&gt;</pre>

<h4>要素・属性</h4>
<p>iモードブラウザ 2.0ではさまざまな要素・属性が追加されています。詳細はドコモ公式の<a href="http://www.nttdocomo.co.jp/service/imode/make/content/browser/browser2/">iモードブラウザ 2.0</a>を参照ください。個人的に上記以外で気になった点は以下でした。</p>

<ul>
  <li>META要素のhttp-equiv=&quot;refresh&quot;がサポートされました。</li>
  <li>HTML要素でxmlns属性が指定できるようになりました（もっともレンダリングには影響しないようですが）。</li>
  <li>原則すべての要素で、id属性とclass属性が指定できるようになりました。</li>
  <li>A要素に&ldquo;ib&rdquo;という属性が追加されました。この属性が付与されたリンクは、フルブラウザで開かれます。</li>
</ul>

<hr />

<p>iモードブラウザ 2.0は、画面サイズとキャッシュ容量の拡大、JavaScriptのサポート、CSSの改善などで、PC向けのブラウザに近い表現力を身につけたものになりました。しかしPC向けのブラウザと比べて遜色のないものとなったかというと、そういうわけでは決してありません。おそらく他社との差別化を図る一方で、自社のスマートフォンやフルブラウザとの差別化、および従来との下位互換性の配慮などによる、ある意味妥協の産物のようにも思えます。</p>
<p>個人的にはiモードブラウザ 2.0の最大の魅力はJavaScriptだと思うのですが、残念ながらこれは、最初に発売された端末の一時的な発売中止以来、現時点まで無効にされたままです。この発売中止の際のドコモの対応は、自分の知る限り過去に例をみないもので、緊急のアップデートを繰り返し、そのたびにUser-Agentを変更し、さらには期日までにアップデートを行わなかった端末はパケット通信を不能にするという、極めて切迫したものでした。そして今でもJavaScript機能は無効にされたままです。果たしてこうした対応を行わざるを得ないほどの不具合とはいったいなんだったのでしょう。なんにせよ、この機能は早々に復活して欲しいものです。</p>
<p>以上、先日iPhoneにMNPしてドコモとおさらばした五十川がお送りしました。</p>

<h3>2010-02-11追記</h3>

<p>2010年2月発売のP-03Bのブラウザには「iモードブラウザ2.0LE」という呼称が与えられ、通常のiモードブラウザ2.0とは区別されています。通常のiモードブラウザ2.0との相違は、<a href="http://www.nttdocomo.co.jp/service/imode/make/content/browser/browser2/caution/index.html#p07">iモードブラウザ2.0LEの対象機種と省略機能について</a>によると、P-03Bの場合はVGA非対応ということですが、LEがイコールVGA非対応であるのか、それ以外にもなんらかの制約があるものを総称してLEと呼ぶのかは、現時点では不明です。</p>

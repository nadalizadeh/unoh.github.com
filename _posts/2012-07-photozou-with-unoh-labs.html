---
layout: post
permalink: /2012/07/photozou-with-unoh-labs.html
title: "フォト蔵、そしてウノウラボ"
date: 2012-07-17T15:03:01.00+09:00
tags:
  - "yamaoka"
---
<p>こんにちは。お久しぶりです、<a href="https://twitter.com/hiro_y">yamaoka</a>です。<a href="http://blog.kotori.in/post/20565502784">プライベートなブログにも書きました</a>が、現在は<a href="http://garage.co.jp/">株式会社デジタルガレージ</a>で<a href="http://photozou.jp/">写真コミュニティサイト「フォト蔵」</a>の制作・運営をしています。</p>

<h3>この半年でフォト蔵が変わったこと</h3>

<p>フォト蔵が<a href="http://garage.co.jp/pr/pressreleases/120406_dg_photozou.html">デジタルガレージに事業譲渡された</a>のは2012年4月でした。もう4ヶ月が経つのですね。その前後からいくつかの変更を行ってきているのでまとめて紹介します。</p>

<h4 style="margin-top: 20px; font-weight: bold;">スマートフォンへの対応</h4>

<p>2月に<a href="http://news.photozou.jp/post/19340964881/photozou-smartphone">webのスマートフォン版をリリース</a>しています。もともとフォト蔵では<a href="https://twitter.com/">Twitter</a>からのご利用が非常に多く、スマートフォンへの対応は急務でした。実は制作には非常に長い期間がかかっているのですが、リリースできて本当によかったと思っています。そして現在、アップロードを簡単に行える方法がない（メールでのアップロードのみサポート）のでアップロードをサポートするためのアプリの開発を進めているところです。ご期待ください。</p>

<h4 style="margin-top: 20px; font-weight: bold;">PHP 5.3系へのアップグレード</h4>

<p>フォト蔵がサービス開始したのは2005年。もう7年も前のことです。当時のPHPのバージョンは4でした。まだフレームワークと呼べるような定番の実装は多くなく、フォト蔵の開発も自社フレームワークを使用して行われました。PHP 4系を使い続けるデメリットはセキュリティ的な問題の他に、何か新しい実装を行いたい場合に利用できるライブラリが全くないことがあります。今どきのライブラリはPHP 5系、もっと言うと5.3系以上でないと動かないものが多くなってきていますからね。</p>

<p>その状態を打開すべく、PHP 5.3系へのアップグレードを6月に行いました。コードを全面的に書き換えるのはコストが高すぎるので、画像変換の部分（<a href="http://www.magickwand.org/">MagickWand for PHP</a>から<a href="http://pecl.php.net/package/imagick">PECL::Imagick</a>に利用ライブラリを変更しました）以外のコードは極力いじらないこととし、コードの自動変換プログラムを作成、実行して機械的に対応させた後でそれぞれ動作の確認を行いました。この先少しずつコードを置き換えていくことになるかと思います。</p>

<h4 style="margin-top: 20px; font-weight: bold;">クラウドストレージの利用開始</h4>

<p>フォト蔵は都内某所のデータセンターで運用されています。写真をお預かりするストレージサービスなので、当然データ量は増え続けます。今までは2Uのストレージサーバーを導入してきましたが、ラックの維持費などコストも考慮すると今後はクラウドサービスの利用が妥当なのではないかという結論にいたり、順次<a href="http://aws.amazon.com/jp/s3/">Amazon S3</a>のサービス利用を始めています。ウノウ時代に<a href="http://blog.kushii.net/archives/762513.html">社内にサーバーがあった</a>ころから考えると、ずいぶん遠くまで来たものです。</p>

<p>実装としては<a href="http://aws.amazon.com/jp/sdkforphp/">Amazonから提供されているSDK</a>を利用して既存のストレージと両方を扱えるような中間レイヤーを用意しました。また、インターネットに公開されている静的画像の配信にVarnishを利用しているので、Amazon S3をbackendに設定することでキャッシュを行っています。Amazon S3では転送量に応じて課金が発生するので、そのコストを抑えることは非常に重要です。ちなみに今のところ<a href="http://aws.amazon.com/jp/cloudfront/">Amazon CloudFront</a>は利用していません。</p>

<h3>フォト蔵とウノウラボ</h3>

<p>フォト蔵はウノウの主力サービスだったこともあり、今まで多くの話題をウノウラボに提供してきました。もう古くなってしまった情報も多いですが、何かしら皆様の参考になっていてくれれば幸いです。実はウノウ、Zynga Japanの社内でもフォト蔵などの自社サービスで培ってきた知識、ノウハウが後続のサービスやゲームに大きな影響を与えています。</p>

<h3>ウノウラボとは何だったのか</h3>

<p>今からふり返ると、ウノウラボというのは本当に奇跡のようなバランスで成り立っていた技術ブログだったのだなと思います。会社としての明確な後押し、そしてきちんと技術について責任を持って説明できるだけの能力を持ったエンジニアたち。何よりもそれを続けることができていたということ。情報をできるだけ広く共有・公開しておくメリットは計り知れません。ウノウラボがどのように運営されていたかについては<a href="http://venturecafe.jp/interview/unohlab/">以前インタビューを受けています</a>ので、よろしければ参考にどうぞ。</p>

<p>ウノウラボがもたらしたものとしては、会社としてのブランディングはもちろん、採用活動を非常にスムーズに行うことができるという思わぬメリットもありました。しばらくの間採用担当をしていた時期があるのですが、面接にいらっしゃるエンジニアさんはほとんどウノウラボを知っていて、そこに惹かれて応募しましたという方が多かったです。</p>

<p>今では多くのweb系の企業で技術ブログが運営されるようになっているのを見ると、その嚆矢としてウノウラボは一定の役割を果たせたかなという自負はあります。そしてそこに寄与できたことをとてもうれしく思っています。

<h3>引き続きよろしくお願いします</h3>

<p>ぼく自身はもうウノウ改めZynga Japanを離れてはいますが、フォト蔵は間違いなくウノウから生まれたプロダクトであり、その精神を受け継いでいるのだなと感じながら仕事しています。引き続き、<a href="http://photozou.jp/">写真コミュニティサイト「フォト蔵」</a>をよろしくお願いいたします。今までどうもありがとうございました。</p>
